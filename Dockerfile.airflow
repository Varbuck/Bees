FROM docker.io/bitnami/airflow:2

USER root
RUN apt-get update
RUN apt-get update && apt-get install -y build-essential libpq-dev
RUN pip install psycopg2-binary apache-airflow apache-airflow-providers-apache-spark

# Corrigir permissões do diretório de dados
RUN mkdir -p /bitnami/postgresql/data && \
    chown -R 1001:1001 /bitnami/postgresql/data && \
    chmod -R 775 /bitnami/postgresql/data
USER 1001